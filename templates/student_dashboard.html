{% extends 'base.html' %}
{% block content %}
  <h2 style="text-align:center; margin-top:12px;">Student Dashboard â€” {{ user.username }}</h2>

  <div style="width:80%; margin:0 auto; text-align:center;">
    <p style="font-size:18px;">
      {% if avg is not none %}
        <strong>Average:</strong> {{ '%.2f'|format(avg) }}% ({{ total_scored }} / {{ total_possible }})
      {% else %}
        <strong>No submissions yet</strong>
      {% endif %}
    </p>

    <p>
      <a href="/student/performance">
        <button style="padding:8px 14px; margin-bottom:10px;">ðŸ“Š View My Performance</button>
      </a>
    </p>

    <!-- New: Download Report Button -->
    <p>
      <a href="{{ url_for('download_student_report', username=user.username) }}">
        <button style="padding:8px 14px;">ðŸ“„ Download My Report</button>
      </a>
    </p>

    <h3 style="margin-top:30px;">Available Tests</h3>
    <ul style="list-style:none; padding:0;">
      {% for s in summaries %}
        <li style="margin-bottom:10px; padding:10px; border:1px solid #ccc; border-radius:6px;">
          <strong>{{ s.test.title }}</strong> â€” Possible: {{ s.possible }} â€”
          {% if s.scored is not none %}
            Scored: {{ s.scored }}
          {% else %}
            <a href="/student/take/{{ s.test.id }}">
              <button style="padding:6px 10px;">Take</button>
            </a>
          {% endif %}
        </li>
      {% else %}
        <li>No tests assigned</li>
      {% endfor %}
    </ul>
  </div>
{% endblock %}