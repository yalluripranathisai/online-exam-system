{% extends 'base.html' %}
{% block content %}
  <h2 style="text-align:center;">Add Question — {{ test.title }}</h2>

  <div style="text-align:center; margin-bottom:12px;">
    <a href="{{ url_for('faculty_dashboard') }}"><button style="padding:6px 10px;">← Back to Dashboard</button></a>
    <a href="{{ url_for('view_submissions', test_id=test.id) }}"><button style="padding:6px 10px;">View Submissions</button></a>
    <a href="{{ url_for('test_scores', test_id=test.id) }}"><button style="padding:6px 10px;">View Scores</button></a>
  </div>

  <form method="post" style="width:80%; margin: 0 auto; background:white; padding:16px; border-radius:8px;">
    <label style="display:block; text-align:left; margin-bottom:8px;">Question text<br>
      <textarea name="qtext" required style="width:100%; min-height:80px; padding:8px;"></textarea>
    </label>

    <label style="display:block; text-align:left; margin-bottom:8px;">
      Type
      <select name="qtype" id="qtype-select" style="width:100%; padding:8px;">
        <option value="mcq_single">MCQ (single)</option>
        <option value="mcq_multi">MCQ (multi)</option>
        <option value="short_text">Short text</option>
        <option value="numeric">Numeric</option>
      </select>
    </label>

    <label style="display:block; text-align:left; margin-bottom:8px;">
      Marks <input name="marks" type="number" step="0.5" value="1" style="padding:8px; width:120px;">
    </label>

    <div id="mcq-area" style="margin-top:8px;">
      <h4 style="margin:6px 0;">Options</h4>
      <div id="options-container">
        <div class="option-row" style="margin-bottom:6px;">
          <input name="option" class="option-input" placeholder="Option text" style="padding:8px; width:70%;">
          <label><input type="checkbox" name="correct" class="option-cb"> Correct</label>
        </div>
        <div class="option-row" style="margin-bottom:6px;">
          <input name="option" class="option-input" placeholder="Option text" style="padding:8px; width:70%;">
          <label><input type="checkbox" name="correct" class="option-cb"> Correct</label>
        </div>
      </div>
      <p><button id="add-option-btn" style="padding:6px 10px;">Add option</button></p>
    </div>

    <div id="expected-area" style="display:none; margin-top:8px;">
      <label>Expected answer <input name="expected" style="padding:8px; width:60%;"></label>
    </div>

    <div style="text-align:center; margin-top:12px;">
      <button type="submit" style="padding:10px 18px;">Add Question</button>
    </div>
  </form>

  <h3 style="text-align:center; margin-top:18px;">Existing Questions</h3>
  <ul style="width:85%; margin:0 auto 40px; list-style:none; padding:0;">
    {% for q in questions %}
      <li style="background:white; padding:12px; margin:8px 0; border-radius:6px; box-shadow:0 2px 4px rgba(0,0,0,0.08);">
        <strong>{{ loop.index }}).</strong> {{ q.qtext }} — <em>{{ q.type }}</em> — {{ q.marks }} marks
      </li>
    {% else %}
      <li style="text-align:center; padding:12px;">No questions yet</li>
    {% endfor %}
  </ul>

  <script>
    // small client-side helpers (keeps checkbox value in sync)
    function syncOptionCheckboxes() {
      document.querySelectorAll('.option-row').forEach(function(row) {
        var input = row.querySelector('.option-input');
        var cb = row.querySelector('.option-cb');
        if (!input || !cb) return;
        cb.value = input.value;
        input.addEventListener('input', function() { cb.value = input.value; });
      });
    }
    document.addEventListener('DOMContentLoaded', function() {
      syncOptionCheckboxes();
      var addBtn = document.getElementById('add-option-btn');
      addBtn.addEventListener('click', function(e) {
        e.preventDefault();
        var container = document.getElementById('options-container');
        var newRow = document.createElement('div');
        newRow.className = 'option-row';
        newRow.style = 'margin-bottom:6px;';
        newRow.innerHTML = '<input name="option" class="option-input" placeholder="Option text" style="padding:8px; width:70%;"> <label><input type="checkbox" name="correct" class="option-cb"> Correct</label>';
        container.appendChild(newRow);
        syncOptionCheckboxes();
      });

      // show/hide expected/MCQ areas
      var qtype = document.getElementById('qtype-select');
      qtype.addEventListener('change', function(e){
        if (e.target.value.startsWith('mcq')) {
          document.getElementById('mcq-area').style.display = 'block';
          document.getElementById('expected-area').style.display = 'none';
        } else {
          document.getElementById('mcq-area').style.display = 'none';
          document.getElementById('expected-area').style.display = 'block';
        }
      });
    });
  </script>
{% endblock %}
